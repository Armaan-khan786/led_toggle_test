name: ESP32 Toggle Test

on:
workflow_dispatch:
push:
branches:
- main

jobs:
toggle-test:
runs-on: self-hosted

steps:
  - name: Checkout repository
    uses: actions/checkout@v4

  - name: Setup Arduino CLI
    run: |
      echo "Arduino CLI assumed present in repo folder"

  - name: Compile Sender ESP
    run: |
      cd sender
      ..\arduino-cli.exe compile --fqbn esp32:esp32:esp32 sender.ino

  - name: Compile Receiver ESP
    run: |
      cd receiver
      ..\arduino-cli.exe compile --fqbn esp32:esp32:esp32 receiver.ino

  - name: Flash Sender ESP (COM6)
    run: |
      cd sender
      ..\arduino-cli.exe upload -p COM6 --fqbn esp32:esp32:esp32 sender.ino

  - name: Flash Receiver ESP (COM7)
    run: |
      cd receiver
      ..\arduino-cli.exe upload -p COM7 --fqbn esp32:esp32:esp32 receiver.ino

  - name: Run Toggle Monitor
    run: |
      python .\monitor.py

  - name: Test Result
    run: |
      echo "Toggle test completed âœ…"
